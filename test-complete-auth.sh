#!/bin/bash

echo "üîÑ TESTE COMPLETO DE AUTENTICA√á√ÉO E API DO MERCADO LIVRE"
echo "========================================================"
echo ""

BASE_URL="https://peepers.vercel.app"

echo "1Ô∏è‚É£ TESTANDO STATUS DA APLICA√á√ÉO..."
echo "-----------------------------------"
echo "Health Check:"
curl -s -w "\nStatus: %{http_code}\n" "$BASE_URL/api/health" | head -5
echo ""

echo "2Ô∏è‚É£ TESTANDO AUTENTICA√á√ÉO SEM LOGIN..."
echo "-------------------------------------"
echo "Status de autentica√ß√£o (deve retornar 401):"
curl -s -w "\nStatus: %{http_code}\n" "$BASE_URL/api/auth/me"
echo ""

echo "Produtos sem autentica√ß√£o (deve retornar 401):"
curl -s -w "\nStatus: %{http_code}\n" "$BASE_URL/api/products?format=summary&limit=5"
echo ""

echo "3Ô∏è‚É£ INICIANDO FLUXO DE AUTENTICA√á√ÉO..."
echo "-------------------------------------"
echo "üîó URL para autentica√ß√£o (abra no navegador):"
echo "$BASE_URL/api/auth/mercado-livre"
echo ""
echo "üìã INSTRU√á√ïES:"
echo "1. Abra a URL acima no navegador"
echo "2. Complete o login no Mercado Livre"
echo "3. Ap√≥s o redirecionamento, volte aqui e pressione ENTER"
echo ""
read -p "‚è≥ Pressione ENTER ap√≥s completar a autentica√ß√£o..."

echo ""
echo "4Ô∏è‚É£ TESTANDO AP√ìS AUTENTICA√á√ÉO..."
echo "--------------------------------"
echo "‚ö†Ô∏è  IMPORTANTE: Os pr√≥ximos testes precisam usar os cookies do navegador"
echo "Para testar com cookies, use as DevTools do navegador ou:"
echo ""
echo "Teste manual no navegador:"
echo "- $BASE_URL/api/auth/me"
echo "- $BASE_URL/api/products?format=summary&limit=10"
echo ""

echo "5Ô∏è‚É£ COMANDOS PARA TESTE MANUAL..."
echo "--------------------------------"
echo "Copie e execute no navegador (DevTools Console):"
echo ""
echo "// Teste de autentica√ß√£o"
echo "fetch('$BASE_URL/api/auth/me', {credentials: 'include'})"
echo "  .then(r => r.json())"
echo "  .then(console.log)"
echo ""
echo "// Teste de produtos"
echo "fetch('$BASE_URL/api/products?format=summary&limit=10', {credentials: 'include'})"
echo "  .then(r => r.json())"
echo "  .then(console.log)"
echo ""

echo "6Ô∏è‚É£ PR√ìXIMOS PASSOS..."
echo "---------------------"
echo "Ap√≥s autentica√ß√£o bem-sucedida:"
echo "1. Acesse: $BASE_URL/admin/produtos"
echo "2. Verifique se os produtos reais s√£o carregados"
echo "3. Confirme se n√£o h√° mais dados mock"
echo ""

echo "‚úÖ Script preparado! Execute a autentica√ß√£o e teste as APIs."